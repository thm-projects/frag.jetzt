@if (updatedMessages().length === 0) {
  <div class="container">
    <div class="header">
      <div class="options">
        <button
          [matMenuTriggerFor]="assistantMenu"
          mat-button>
          <mat-icon [matTooltip]="i18n().assistant">
            keyboard_arrow_down
          </mat-icon>
          {{ i18n().assistant }}
        </button>

        <mat-menu #assistantMenu="matMenu">
          @for (entry of assistRefs(); track entry) {
            <button
              mat-menu-item
              [disabled]="entry.ref.id === selectedAssistant()"
              (click)="selectedAssistant.set(entry.ref.id)">
              {{ entry.assistant.name }}
            </button>
          }
          @if (isPrivileged()) {
            <button
              mat-menu-item
              (click)="onNewClick()()">
              <em>{{ i18n().createAssistant }}</em>
            </button>
          }
        </mat-menu>
      </div>
    </div>
    <div class="inner-container">
      <div class="titles">
        <span class="title">{{ i18n().title }}</span>
      </div>

      @if (!overrideMessage()) {
        <div class="outer">
          <div class="input-container">
            <textarea
              matInput
              rows="2"
              cdkTextareaAutosize
              cdkAutosizeMinRows="5"
              cdkAutosizeMaxRows="7"
              [formControl]="inputMessage"
              [placeholder]="i18n().placeholder"
              #inputElem
              (keydown)="onKeyDown($event)"
              (input)="updateHeight(inputElem)"></textarea>

            @if (files().length; as length) {
              <div
                class="attachments"
                style="max-height: 200px; overflow-y: auto">
                @for (file of files(); track file) {
                  <div class="file-box">
                    <mat-icon class="file-icon">description</mat-icon>
                    <span class="file-name">{{ file.name }}</span>
                  </div>
                }
              </div>
            }

            <div class="actions">
              <div class="left-buttons">
                <button
                  mat-button
                  (click)="fileInput.click()">
                  <mat-icon>attach_file</mat-icon>
                  {{ i18n().attachment }}
                  <input
                    #fileInput
                    (change)="onFileChange(fileInput.files)"
                    type="file"
                    multiple
                    accept=".c,.cs,.cpp,.doc,.docx,.html,.java,.json,.md,.pdf,.php,.pptx,.py,.rb,.tex,.txt,.css,.js,.sh,.ts"
                    style="display: none" />
                </button>
                <button
                  mat-button
                  [matMenuTriggerFor]="assistantMenu">
                  <mat-icon [matTooltip]="i18n().assistant">more_vert</mat-icon>
                  {{ i18n().more }}
                </button>
              </div>

              @if (canSend()) {
                <button
                  (click)="sendMessage()"
                  mat-icon-button
                  class="send-button">
                  <mat-icon>arrow_upward</mat-icon>
                </button>
              } @else {
                <mat-spinner
                  matSuffix
                  [diameter]="24"
                  [strokeWidth]="2"></mat-spinner>
              }
            </div>
          </div>

          <div class="topics">
            @for (topic of exampleTopics; track topic) {
              <button
                class="topic"
                (click)="sendExampleTopic(topic.question)">
                <span class="emoji">{{ topic.emoji }}</span>
                {{ topic.question }}
              </button>
            }
          </div>
        </div>
      }
    </div>

    <div
      class="center"
      style="text-align: center; margin: 14px">
      <span>
        {{ i18n().disclaimer }}
      </span>
    </div>
  </div>
} @else {
  <div class="container chat">
    <div class="header">
      <div class="options">
        <button
          [matMenuTriggerFor]="assistantMenu"
          mat-button>
          <mat-icon [matTooltip]="i18n().assistant">
            keyboard_arrow_down
          </mat-icon>
          {{ i18n().assistant }}
        </button>

        <button
          mat-button
          (click)="delete()">
          <mat-icon [matTooltip]="i18n().assistant">delete</mat-icon>
          {{ i18n().delete_conversation }}
        </button>

        <mat-menu #assistantMenu="matMenu">
          @for (entry of assistRefs(); track entry) {
            <button
              mat-menu-item
              [disabled]="entry.ref.id === selectedAssistant()"
              (click)="selectedAssistant.set(entry.ref.id)">
              {{ entry.assistant.name }}
            </button>
          }
          @if (isPrivileged()) {
            <button
              mat-menu-item
              (click)="onNewClick()()">
              <em>{{ i18n().createAssistant }}</em>
            </button>
          }
        </mat-menu>
      </div>
    </div>

    <div
      #scroll
      class="messages-container">
      @if (overrideMessage(); as message) {
        <mat-card class="info">
          <mat-card-content>
            <app-markdown-viewer [data]="message"></app-markdown-viewer>
          </mat-card-content>
        </mat-card>
      } @else {
        @for (message of updatedMessages(); track message) {
          @if (message.role === "user") {
            <div class="message user-message">
              <div class="message-content">
                <div class="text-content">
                  @for (messageContent of message.chunks; track $index) {
                    <app-markdown-viewer
                      [data]="messageContent"></app-markdown-viewer>
                  }
                </div>
                <span class="message-icon user-icon">
                  <mat-icon>face</mat-icon>
                </span>
              </div>
              @if (message.attached.length) {
                <div class="attachments">
                  @for (
                    attachment of message.attached;
                    track attachment[0] + attachment[1]
                  ) {
                    <div class="file-box">
                      <mat-icon class="file-icon">description</mat-icon>
                      <span class="file-name">
                        {{
                          i18n().ref
                            | context
                              : { num: attachment[0], file: attachment[1] }
                        }}
                      </span>
                    </div>
                  }
                </div>
              }
            </div>
          } @else {
            <div class="message ai-message">
              <div class="message-content">
                <span class="message-icon ai-icon">
                  <mat-icon svgIcon="fj_robot"></mat-icon>
                </span>
                <div class="text-content">
                  @for (messageContent of message.chunks; track $index) {
                    <app-markdown-viewer
                      [data]="messageContent"></app-markdown-viewer>
                  }
                </div>
              </div>
            </div>
          }
        }
      }
    </div>

    @if (!overrideMessage()) {
      @if (files().length; as length) {
        <div
          class="attachments"
          style="max-height: 200px; overflow-y: auto">
          @for (file of files(); track file) {
            <div class="file-box">
              <mat-icon class="file-icon">description</mat-icon>
              <span class="file-name">{{ file.name }}</span>
            </div>
          }
        </div>
      }

      <div class="input-container-compact">
        <div class="left-buttons">
          <button
            mat-button
            (click)="fileInput.click()">
            <mat-icon>attach_file</mat-icon>
            {{ i18n().attachment }}
            <input
              #fileInput
              (change)="onFileChange(fileInput.files)"
              type="file"
              multiple
              accept=".c,.cs,.cpp,.doc,.docx,.html,.java,.json,.md,.pdf,.php,.pptx,.py,.rb,.tex,.txt,.css,.js,.sh,.ts"
              style="display: none" />
          </button>
          <button
            mat-button
            [matMenuTriggerFor]="assistantMenu">
            <mat-icon [matTooltip]="i18n().assistant">more_vert</mat-icon>
            {{ i18n().more }}
          </button>
        </div>

        <div class="textarea-wrapper">
          <textarea
            matInput
            placeholder="Follow up questions..."
            rows="1"
            cdkAutosizeMinRows="1"
            cdkAutosizeMaxRows="3"
            [formControl]="inputMessage"
            (keydown)="onKeyDown($event)"></textarea>
        </div>

        <div class="right-buttons">
          @if (canSend()) {
            <button
              (click)="sendMessage()"
              mat-icon-button
              class="send-button">
              <mat-icon>arrow_upward</mat-icon>
            </button>
          } @else {
            <mat-spinner
              matSuffix
              [diameter]="24"
              [strokeWidth]="2"></mat-spinner>
          }
        </div>
      </div>
    }
  </div>
}

<!--<mat-toolbar>
  <ng-content></ng-content>
</mat-toolbar>-->

<!--@if (updatedMessages().length === 0) {
  <div class="container">
    <h1>frag.jetzt mit ChatGPT</h1>
    <div class="search-bar">
      <div class="actions">
        <button class="attachment-button">
          <span class="material-symbols-outlined">attach_file_add</span>
        </button>
        <button class="assistant-button">
          <span class="material-symbols-outlined">more_vert</span>
        </button>
      </div>
      <textarea
        [formControl]="inputMessage"
        placeholder="Ask anything..."></textarea>
      <button
        class="search-button"
        (click)="sendMessage()">
        <span class="material-symbols-outlined">arrow_upward</span>
      </button>
    </div>
    <div class="topics">
      <button class="topic">
        <span class="emoji">üí°</span>
        World's greatest hikes
      </button>
      <button class="topic">
        <span class="emoji">üç´</span>
        Health benefits of dark chocolate
      </button>
      <button class="topic">
        <span class="emoji">ü•ó</span>
        Healthiest cooking oils
      </button>
      <button class="topic">
        <span class="emoji">üó≥Ô∏è</span>
        Registration deadlines for the US election
      </button>
    </div>
  </div>
} @else {
  <div
    #scroll
    class="messages-container">
    @if (overrideMessage(); as message) {
      <mat-card class="info">
        <mat-card-content>
          <app-markdown-viewer [data]="message"></app-markdown-viewer>
        </mat-card-content>
      </mat-card>
    } @else {
      @for (message of updatedMessages(); track message) {
        @if (message.role === "user") {
          <mat-card class="user-card">
            <mat-card-content style="padding: 4px 24px;">
              @for (messageContent of message.chunks; track $index) {
                <app-markdown-viewer
                  class="user-message"
                  [data]="messageContent"></app-markdown-viewer>
              }
              @if (message.attached.length) {
                <div>
                  @for (
                    attachment of message.attached;
                    track attachment[0] + attachment[1]
                  ) {
                    <span class="file-ref">
                      {{
                        i18n().ref
                          | context: { num: attachment[0], file: attachment[1] }
                      }}
                    </span>
                  }
                </div>
              }
            </mat-card-content>
          </mat-card>
        } @else {
          @for (messageContent of message.chunks; track $index) {
            <div class="reply-container">
              <div class="icon">
                <span class="material-symbols-outlined">smart_toy</span>
              </div>
              <app-markdown-viewer
              class="assistant-message"
              [data]="messageContent"></app-markdown-viewer>
            </div>
          }
        }
      }
    }

    @if (!overrideMessage()) {
      <div class="input-area">
        <mat-form-field
          class="input-field"
          appearance="outline">
          <mat-label>{{ i18n().input }}</mat-label>
          <textarea
            matInput
            [formControl]="inputMessage"
            [placeholder]="i18n().placeholder"
            #inputElem
            (keydown)="onKeyDown($event)"
            (input)="updateHeight(inputElem)"
            cdkTextareaAutosize
            cdkAutosizeMinRows="1"
            cdkAutosizeMaxRows="5"></textarea>
          <button
            mat-icon-button
            (click)="fileInput.click()"
            matPrefix>
            <mat-icon>attach_file_add</mat-icon>
            <input
              #fileInput
              (change)="onFileChange(fileInput.files)"
              type="file"
              multiple
              accept=".c,.cs,.cpp,.doc,.docx,.html,.java,.json,.md,.pdf,.php,.pptx,.py,.rb,.tex,.txt,.css,.js,.sh,.ts"
              style="display: none" />
          </button>
          <button
            [matMenuTriggerFor]="assistantMenu"
            mat-icon-button
            matPrefix>
            <mat-icon [matTooltip]="i18n().assistant">more_vert</mat-icon>
          </button>
          @if (canSend()) {
            <button
              (click)="sendMessage()"
              mat-icon-button
              matSuffix>
              <mat-icon>arrow_upward</mat-icon>
            </button>
          } @else {
            <mat-spinner
              matSuffix
              [diameter]="24"
              [strokeWidth]="2"></mat-spinner>
          }
          <mat-hint>
            @if (files().length; as length) {
              {{
                i18n().uploadedFiles
                  | context
                    : {
                        count: length,
                        files: filesString()
                      }
              }}
            }
          </mat-hint>
        </mat-form-field>
        <span>ChatGPT kann Fehler machen.</span>
      </div>
    }
  </div>

  <mat-menu #assistantMenu="matMenu">
    @for (entry of assistRefs(); track entry) {
      <button
        mat-menu-item
        [disabled]="entry.ref.id === selectedAssistant()"
        (click)="selectedAssistant.set(entry.ref.id)">
        {{ entry.assistant.name }}
      </button>
    }
    @if (isPrivileged()) {
      <button
        mat-menu-item
        (click)="onNewClick()()">
        <em>{{ i18n().createAssistant }}</em>
      </button>
    }
  </mat-menu>
}
-->
