<mat-dialog-content>
  <mat-card>
    <mat-slide-toggle [(ngModel)]="considerVotes">{{'topic-cloud-dialog.consider-votes' | translate}}</mat-slide-toggle>
    <mat-slide-toggle [(ngModel)]="profanityFilter">{{'topic-cloud-dialog.profanity' | translate}}</mat-slide-toggle>
  </mat-card>

  <div fxLayout="row" style="margin-top: 10px;">
    <mat-label fxLayoutAlign="center center">
      <mat-icon>search</mat-icon>
    </mat-label>
    <div style="margin-left: 10px;">
      <mat-form-field class="example-form-field">
        <input #searchBox id="searchBox" (input)="searchKeyword()"
               [(ngModel)]="searchedKeyword" matInput type="text"
               placeholder="{{'topic-cloud-dialog.keyword-search' | translate}}">
        <button *ngIf="searchedKeyword"
                (click)="searchedKeyword = ''; searchMode = false;"
                mat-button matSuffix mat-icon-button aria-label="topic-cloud-dialog.keyword-search">
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>
    </div>
    <div fxLayoutAlign="end" style="margin-left: 52%;">
      <button  mat-button [matMenuTriggerFor]="sortMenu" mat-ripple>
        <mat-icon>sort</mat-icon>
      </button>
    </div>
  </div>

  <mat-menu #sortMenu>
    <button mat-menu-item (click)="sortQuestions('alphabetic')">
      <mat-icon>sort_by_alpha</mat-icon>
      {{'topic-cloud-dialog.sort-alpha' | translate}} </button>
    <button mat-menu-item (click)="sortQuestions('questionsCount')">
      <mat-icon>swap_vert</mat-icon>
      {{'topic-cloud-dialog.sort-count' | translate}} </button>
    <button mat-menu-item (click)="sortQuestions('voteCount')">
      <mat-icon>swap_vert</mat-icon>
      {{'topic-cloud-dialog.sort-vote' | translate}} </button>
  </mat-menu>

  <mat-accordion>
    <mat-expansion-panel hideToggle *ngIf="searchMode && filteredKeywords.length === 0">
        <mat-expansion-panel-header>
            <mat-panel-title fxLayoutAlign="center">
              {{'topic-cloud-dialog.no-keywords-note' | translate}}
            </mat-panel-title>
        </mat-expansion-panel-header>
      </mat-expansion-panel>
    <mat-expansion-panel (opened)="panelOpenState = true"
                         (closed)="panelOpenState = edit = false"
                         *ngFor="let keyword of (searchMode ? filteredKeywords : keywords); let i = index" [attr.data-index]="i">
      <mat-expansion-panel-header class="color">
        <mat-panel-title [ngClass]="{'edit-keyword': editedKeyword}">
          {{keyword.keyword}}
        </mat-panel-title>
        <mat-panel-description>
          {{keyword.questions.length}}
          {{'topic-cloud-dialog.question-count-'+(keyword.questions.length > 1 ? 'plural' : 'singular') | translate}}
        </mat-panel-description>
      </mat-expansion-panel-header>
      <div *ngFor="let question of keyword.questions">
        <mat-divider></mat-divider>
        <app-topic-dialog-comment
        [question]="question"
        [keyword]="keyword.keyword"
        [maxShowedCharachters]="140"
        [isCollapsed]="!panelOpenState"
        ></app-topic-dialog-comment>
      </div>

      <!-- Only visible when not editing -->
      <div *ngIf="!edit" align="end">
        <mat-divider></mat-divider>

        <button class="margin-right" mat-icon-button style="align-self:flex-end;" (click)="editKeyword(i)">
          <mat-icon class="primary">edit</mat-icon>
        </button>
        <button class="margin-right" mat-icon-button style="align-self:flex-end;"
          (click)="openConfirmDialog(keyword)">
          <mat-icon class="red">delete</mat-icon>
        </button>
      </div>

      <!-- Only visible when editing -->
      <div *ngIf="edit">
        <mat-divider></mat-divider>

        <mat-form-field>
          <mat-label>{{'topic-cloud-dialog.edit-keyword-tip' | translate}}</mat-label>
          <input matInput id="{{'edit-input'+i}}" [(ngModel)]="newKeyword">
        </mat-form-field>
        <!-- TODO: textinput and buttons in one row -->
        <div align="end">
          <button mat-raised-button class="redBackground margin-right" (click)="cancelEdit()">{{'topic-cloud-dialog.cancel' | translate}}</button>
          <button mat-raised-button class="primaryBackground" (click)="confirmEdit(keyword)">{{'topic-cloud-dialog.save' | translate}}</button>
        </div>
      </div>
    </mat-expansion-panel>
  </mat-accordion>
</mat-dialog-content>
