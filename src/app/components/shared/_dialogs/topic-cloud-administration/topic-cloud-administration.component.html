<mat-dialog-content>
  <mat-accordion hideToggle>
    <mat-expansion-panel class="color-surface">
      <mat-expansion-panel-header class="color-surface">
        <mat-icon class="color-on-surface" style="margin-right: 10px">settings</mat-icon>
        <mat-panel-title>
          {{'topic-cloud-dialog.settings' | translate}}
        </mat-panel-title>
      </mat-expansion-panel-header>
      <mat-card style="background: none; margin-bottom: 10px;">
        <mat-label class="color-on-surface">
          {{"topic-cloud-dialog.select-choice" | translate}}
        </mat-label>
        <mat-radio-group
        class="radio-button-group"
        [(ngModel)]="sentToSpacyChoice">
          <mat-radio-button checked="true" value="keyword" class="radio-button-item">
            {{"topic-cloud-dialog.keyword" | translate}}
          </mat-radio-button>
          <mat-radio-button value="full-text" class="radio-button-item">
            {{"topic-cloud-dialog.full-text" | translate}}
          </mat-radio-button>
          <mat-radio-button value="keyword-full-text" class="color-on-surface">
            {{"topic-cloud-dialog.both" | translate}}
          </mat-radio-button>
        </mat-radio-group>
      </mat-card>

      <mat-slide-toggle [(ngModel)]="considerVotes">
        {{'topic-cloud-dialog.consider-votes' | translate}}
      </mat-slide-toggle>
      <mat-slide-toggle (change)="refreshAllLists()" [(ngModel)]="profanityFilter">
        {{'topic-cloud-dialog.profanity' | translate}}
      </mat-slide-toggle>
      <mat-slide-toggle [(ngModel)]="hideBlacklist">
        {{'topic-cloud-dialog.hide-blacklist' | translate}}
      </mat-slide-toggle>

      <mat-accordion class="new-Badword" multi>
        <mat-expansion-panel class="color-background" (opened)="enterBadword = true; focusInput('bad-word-input')"
          (closed)="enterBadword = false">
          <mat-expansion-panel-header class="color-background">
            <mat-panel-title>
              {{'topic-cloud-dialog.edit-profanity-list' | translate}}
            </mat-panel-title>
          </mat-expansion-panel-header>

          <mat-form-field>
            <mat-label>{{'topic-cloud-dialog.enter-word' | translate}}</mat-label>
            <input matInput id="bad-word-input" [(ngModel)]="newBadWord">
          </mat-form-field>

          <button mat-stroked-button color="primary" class="margin-left" (click)="addBadword()">
            {{'topic-cloud-dialog.add-word' | translate}}
          </button>

          <mat-list role="list" *ngIf="showBadWordList" class="margin-bottom">
            <mat-list-item class="color-on-surface" *ngFor="let word of getBadWordList()" role="listitem">{{word}}
              <button style="margin-left: auto" mat-icon-button class="red" (click)="removeWordFromBadWords(word)">
                <mat-icon mat-list-icon style="margin-bottom: 6px;">delete</mat-icon>
              </button>
            </mat-list-item>
          </mat-list>

          <div>
            <button mat-raised-button *ngIf="getBadWordList().length > 0" class="primaryBackground"
              (click)="showBadWordList=!showBadWordList">
              {{showBadWordList ? "Hide badword list" : "Show badword list"}}
            </button>
          </div>
        </mat-expansion-panel>

        <mat-expansion-panel class="color-background"
          (opened)="enterBlacklistWord = true; focusInput('blacklist-word-input')"
          (closed)="enterBlacklistWord = false">
          <mat-expansion-panel-header class="color-background">
            <mat-panel-title>
              {{'topic-cloud-dialog.edit-blacklist-list' | translate}}
            </mat-panel-title>
          </mat-expansion-panel-header>

          <mat-form-field>
            <mat-label>{{'topic-cloud-dialog.enter-word' | translate}}</mat-label>
            <input matInput id="blacklist-word-input" [(ngModel)]="newBlacklistWord">
          </mat-form-field>

          <button mat-stroked-button color="primary" class="margin-left" (click)="addBlacklistWord()">
            {{'topic-cloud-dialog.add-word' | translate}}
          </button>

          <mat-list role="list" *ngIf="showBlacklistWordList" class="margin-bottom">
            <mat-list-item class="color-on-surface" *ngFor="let word of getBlacklist()" role="listitem">{{word}}
              <button style="margin-left: auto" mat-icon-button class="red" (click)="removeWordFromBlacklist(word)">
                <mat-icon mat-list-icon style="margin-bottom: 6px;">delete</mat-icon>
              </button>
            </mat-list-item>
          </mat-list>

          <div>
            <button mat-raised-button *ngIf="getBlacklist().length > 0" class="primaryBackground"
              (click)="showBlacklistWordList=!showBlacklistWordList">
              {{showBlacklistWordList ? "Hide blacklist" : "Show blacklist"}}
            </button>
          </div>
        </mat-expansion-panel>
      </mat-accordion>
    </mat-expansion-panel>
  </mat-accordion>

  <div fxLayout="row">
    <mat-label fxLayoutAlign="center center">
      <mat-icon>search</mat-icon>
    </mat-label>
    <div style="margin-left: 10px; margin-top: 6px;">
      <mat-form-field [ngClass]="{'search': searchMode}">
        <input #searchBox class="searchBox" (input)="searchKeyword()" [(ngModel)]="searchedKeyword" matInput type="text"
          placeholder="{{'topic-cloud-dialog.keyword-search' | translate}}">
        <button *ngIf="searchedKeyword" (click)="searchedKeyword = ''; searchMode = false;" mat-button matSuffix
          mat-icon-button aria-label="topic-cloud-dialog.keyword-search">
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>
    </div>
    
    <div fxLayoutAlign="center center" style="margin-left: auto; font-weight: bold;">
      <mat-icon [ngClass]="{'animation-blink': searchMode}">sell</mat-icon>
      <p class="margin-left" [ngClass]="{'animation-blink': searchMode}">{{searchMode ? filteredKeywords.length : keywords.length}}</p>
    </div>
    <div class="margin-left vertical-center">
      <button [ngClass]="{'animation-blink': sortMode!=='alphabetic'}" mat-icon-button
              [matMenuTriggerFor]="sortMenu">
        <mat-icon>sort</mat-icon>
      </button>
    </div>
  </div>

  <mat-menu #sortMenu>
    <button [ngClass]="{'animation-blink': sortMode==='alphabetic'}" mat-menu-item
      (click)="sortQuestions('alphabetic')">
      <mat-icon>sort_by_alpha</mat-icon>
      {{'topic-cloud-dialog.sort-alpha' | translate}}
    </button>
    <button [ngClass]="{'animation-blink': sortMode==='questionsCount'}" mat-menu-item
      (click)="sortQuestions('questionsCount')">
      <mat-icon>swap_vert</mat-icon>
      {{'topic-cloud-dialog.sort-count' | translate}}
    </button>
    <button [ngClass]="{'animation-blink': sortMode==='voteCount'}" mat-menu-item (click)="sortQuestions('voteCount')">
      <mat-icon>swap_vert</mat-icon>
      {{'topic-cloud-dialog.sort-vote' | translate}}
    </button>
  </mat-menu>

  <mat-accordion>
    <mat-expansion-panel class="color-surface" hideToggle *ngIf="searchMode && filteredKeywords.length === 0">
      <mat-expansion-panel-header class="color-surface">
        <mat-panel-title fxLayoutAlign="center">
          {{'topic-cloud-dialog.no-keywords-note' | translate}}
        </mat-panel-title>
      </mat-expansion-panel-header>
    </mat-expansion-panel>

    <mat-expansion-panel class="color-surface" (opened)="panelOpenState = true" (closed)="panelOpenState = edit = false"
      *ngFor="let keyword of
                        (searchMode ? filteredKeywords : keywords); let i = index" [attr.data-index]="i">
      <mat-expansion-panel-header class="color-surface">
        <mat-panel-title>
          {{profanityFilter ? getKeywordWithoutProfanity(keyword.keyword) : keyword.keyword}}
        </mat-panel-title>
        <mat-panel-description>
          {{keyword.questions.length}}
          {{'topic-cloud-dialog.question-count-'+(keyword.questions.length > 1 ? 'plural' : 'singular') | translate}}
        </mat-panel-description>
      </mat-expansion-panel-header>
      <div *ngFor="let question of keyword.questions">
        <mat-divider></mat-divider>
        <app-topic-dialog-comment [question]="question" [keyword]="keyword.keyword" [maxShowedCharachters]="140"
          [isCollapsed]="!panelOpenState" [profanityFilter]="profanityFilter"></app-topic-dialog-comment>
      </div>

      <!-- Only visible when not editing -->
      <div *ngIf="!edit" align="end">
        <mat-divider></mat-divider>

        <button class="margin-right" mat-icon-button style="align-self:flex-end;" (click)="editKeyword(i)">
          <mat-icon class="primary">edit</mat-icon>
        </button>
        <button class="margin-right" mat-icon-button style="align-self:flex-end;"
          (click)="openConfirmDialog(keyword, undefined, 'delete-message', 'delete')">
          <mat-icon class="red">delete</mat-icon>
        </button>
      </div>

      <!-- Only visible when editing -->
      <div *ngIf="edit">
        <mat-divider></mat-divider>
        <mat-form-field>
          <mat-label>{{'topic-cloud-dialog.edit-keyword-tip' | translate}}</mat-label>
          <input matInput id="{{'edit-input'+i}}" [(ngModel)]="newKeyword">
        </mat-form-field>
        <!-- TODO: textinput and buttons in one row -->
        <div align="end">
          <button mat-raised-button class="redBackground margin-right"
            (click)="cancelEdit()">{{'topic-cloud-dialog.cancel' | translate}}</button>
          <button mat-raised-button class="primaryBackground" (click)="confirmEdit(keyword)">{{'topic-cloud-dialog.save'
            | translate}}</button>
        </div>
      </div>
    </mat-expansion-panel>
  </mat-accordion>
</mat-dialog-content>
