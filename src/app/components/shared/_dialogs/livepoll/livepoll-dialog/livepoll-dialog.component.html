<div
  class="title"
  *ngIf="isProduction">
  <p mat-dialog-title>{{ translateKey + ".dialog-title" | translate }}</p>
</div>
<mat-dialog-content
  class="content"
  *ngIf="livepollSession">
  <ng-container
    *ngIf="session.currentRole && livepollSession.active && !isConclusion">
    <app-livepoll-settings [parent]="this"></app-livepoll-settings>
  </ng-container>

  <p style="margin-top: 30px">
    {{ translateKey + ".dialog-preview-title" | translate }}
  </p>

  <p *ngIf="livepollSession.title">{{ livepollSession.title }}</p>

  <div class="info-container">
    <div
      @AnimateInOut
      *ngIf="livepollSession.viewsVisible">
      <span>{{ translateKey + ".participants" | translate }}</span>
      <span>{{ userCount }}</span>
    </div>
    <div
      @AnimateInOut
      *ngIf="livepollSession.resultVisible">
      <span>{{ translateKey + ".votes" | translate }}</span>
      <span>{{ totalVotes }}</span>
    </div>
  </div>

  <div class="result-settings-container">
    <!-- relative / absolute settings -->
  </div>

  <div
    class="result-container"
    @AnimateInOut
    *ngIf="options && livepollSession.resultVisible">
    <div class="left">
      <ng-container *ngFor="let option of options">
        <div class="container">
          <ng-container *ngIf="template.isPlain">
            <ng-container *ngIf="template.translate">
              <span class="option-plain-translate">
                {{
                  (translateKey + "." + option.symbol | translate)[option.index]
                }}
              </span>
            </ng-container>
            <ng-container *ngIf="!template.translate">
              <span class="option-plain">{{ option.symbol }}</span>
            </ng-container>
          </ng-container>
          <ng-container *ngIf="!template.isPlain">
            <mat-icon class="option-icon">{{ option.symbol }}</mat-icon>
          </ng-container>
        </div>
      </ng-container>
    </div>
    <div class="right">
      <ng-container *ngFor="let option of options; index as i">
        <div class="container">
          <div class="background">
            <div
              class="bar"
              *ngIf="votes"
              [ngStyle]="{
                width: getVoteBarSize(i) + '%'
              }"></div>
          </div>
          <div class="foreground">
            <span>
              {{
                getVotePercentage(i) +
                  (languageService.currentLanguage() === "de" ? " " : "")
              }}%
            </span>
          </div>
        </div>
      </ng-container>
    </div>
  </div>

  <div
    class="vote-container"
    *ngIf="!isConclusion && livepollSession.active">
    <div
      [ngClass]="'reverse-' + !!template.reverse + ' grid-' + template.isGrid"
      [ngStyle]="{ 'grid-template-rows': 'repeat(' + rowHeight + ',1fr)' }"
      *ngIf="template">
      <ng-container *ngIf="template.symbols">
        <ng-container *ngFor="let symbol of template.symbols; index as i">
          <ng-container
            *ngTemplateOutlet="
              option;
              context: {
                i: i,
                symbol: symbol
              }
            "></ng-container>
        </ng-container>
      </ng-container>
      <ng-container *ngIf="template.length">
        <ng-container
          *ngFor="let symbol of [].constructor(template.length); index as i">
          <ng-container
            *ngTemplateOutlet="
              option;
              context: {
                i: i,
                symbol: i
              }
            "></ng-container>
        </ng-container>
      </ng-container>
    </div>
  </div>
</mat-dialog-content>

<mat-dialog-actions
  *ngIf="isProduction"
  class="actions-container"
  #dialogActions>
  <div class="left-container">
    <button
      mat-flat-button
      class="button-primary action-button"
      *ngIf="session.currentRole && !isConclusion"
      (click)="isPaused ? play() : pause()">
      <mat-icon>{{ isPaused ? "play_circle" : "pause_circle" }}</mat-icon>
      <span
        *ngIf="device.isCurrentlyDesktop"
        class="on-desktop">
        {{
          translateKey +
            ".creator-settings-" +
            (isPaused ? "continue" : "pause") | translate
        }}
      </span>
    </button>
    <button
      mat-flat-button
      class="button-cancel action-button"
      *ngIf="session.currentRole && isProduction && !isConclusion"
      (click)="delete()">
      <mat-icon style="color: var(--red)">stop_circle</mat-icon>
      <span
        *ngIf="device.isCurrentlyDesktop"
        class="on-desktop">
        {{ translateKey + ".creator-settings-delete" | translate }}
      </span>
    </button>
  </div>
  <div class="right-container">
    <button
      mat-flat-button
      class="button-cancel action-button"
      *ngIf="isProduction"
      (click)="closeEmitter.emit()">
      <span>{{ translateKey + ".close" | translate }}</span>
    </button>
    <button
      mat-flat-button
      *ngIf="
        session.currentRole && (dialogActions.offsetWidth > 310 || isConclusion)
      "
      (click)="createNewLivepoll()"
      class="button-secondary action-button">
      <mat-icon style="margin-right: 4px">add_circle</mat-icon>
      <span
        *ngIf="device.isCurrentlyDesktop"
        class="on-desktop">
        {{ translateKey + ".new" | translate }}
      </span>
    </button>
  </div>
</mat-dialog-actions>

<ng-template
  #option
  let-i="i"
  let-symbol="symbol">
  <button
    [ngClass]="
      livepollVote?.voteIndex === i
        ? 'button-vote-active'
        : 'button-vote-default'
    "
    mat-flat-button
    class="vote-text"
    [disabled]="isPaused"
    (click)="vote(i)">
    <ng-container
      *ngTemplateOutlet="
        optionEntry;
        context: { i: i, symbol: symbol }
      "></ng-container>
  </button>
</ng-template>

<ng-template
  #optionEntry
  let-i="i"
  let-symbol="symbol">
  <ng-container *ngIf="template.isPlain">
    <span
      class="vote-plain-text"
      [ngStyle]="
        template.translate ? template.style?.text : template.style?.plainIcon
      ">
      {{
        template.translate
          ? (translateKey + "." + "option-" + template.name! | translate)[i]
          : symbol
      }}
    </span>
  </ng-container>
  <ng-container *ngIf="!template.isPlain">
    <mat-icon [ngStyle]="template.style?.matIcon">
      {{ symbol }}
    </mat-icon>
  </ng-container>
</ng-template>
